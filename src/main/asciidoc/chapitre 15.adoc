
Chapitre 15

Avons-nous fait le bon choix ?
------------------------------

Le service Geegol Shopping List (désormais disponible dans 27 langues,
dont le breton) est devenu un service phare du groupe. Projet
expérimental au départ, il est aujourd'hui un élément stratégique et les
décideurs du groupe veulent quelques garanties sur nos méthodes de
travail et notre outillage.

Maven a répondu présent pour chaque problème que nous avons rencontré.
Si nous sommes contents de notre choix, qu'en sera-t-il dans six mois,
un an, puis dans cinq ? Maven est un bon outil, mais n'est pas pour
autant le Saint-Graal et n'est pas exempt de défauts.

Toute l'équipe est donc réunie pour défendre ce choix face à un comité
d'experts qui ne veut pas laisser un si beau projet reposer sur des
outils non fiables, mal documentés ou dont l'avenir est incertain.
À nous de nous montrer convaincants…

$$$ commite.png[float="left"] $$$

Les limites
~~~~~~~~~~~

image:illustrations/MangaFabrice.png[float="left"]

Fabrice prend les devants et expose d'office les limites que nous avons
constatées lors de l'utilisation de Maven. Nous ne sommes pas face à des
débutants prêts à croire que Maven est la solution à tout, autant jouer
franc-jeu pour désamorcer ce sujet dès le début.

Maven n'est pas l'outil magique qui va traiter tous nos problèmes avant
même qu'ils n’arrivent – si vous cherchez ce genre de solution, essayez
l'annotation @Abracadabra dans votre code. Comme tout outil, il a ses
forces mais aussi ses faiblesses et ses limites, et il faut apprendre à
faire avec et à les contourner intelligemment.

Points faibles
^^^^^^^^^^^^^^

Il y a une critique, en particulier, qui vous a probablement déjà
titillé : la syntaxe XML inutilement verbeuse. L'intégration dans les
IDE tend à gommer ce détail, mais il est néanmoins bien présent dès
qu'on s'attaque à configurer un gros plugin comme Cargo (voir
Chapitre 8).

Qu'est-ce qui empêche de modifier ce format POM pour le rendre plus
compact, ou lui ajouter des fonctionnalités ? Le code qui analyse ces
fichiers XML est actuellement lié à une version de Maven. Si un nouveau
Maven sortait avec un format POM plus souple ou intégrant une nouvelle
fonctionnalité, il ne serait exploitable que par les utilisateurs de
cette nouvelle version de Maven. Au sein d'une équipe de développement,
cela ne serait pas un gros problème ; la difficulté concerne les POM
déployés par des projets dans un dépôt d'artefacts, en particulier les
projets open-source qui déploient sur central. Leur utilisation ne
serait alors possible que pour les utilisateurs du nouveau Maven. Une
prise en otage inacceptable !

image:illustrations/MangaStephane.png[float="left"]

Une deuxième limite de Maven concerne son fonctionnement en mode
multimodule, en particulier lorsqu'on exploite l'héritage naturel : la
construction du projet POM parent doit se terminer avant que celle de
ses modules ne commence, afin qu'ils puissent y faire référence. Il
n'est donc pas possible d'intégrer dans notre projet parent un plugin
qui s'exécuterait _après_la construction des modules. Ce problème,
Stéphane l'a rencontré et contourné au Chapitre 13. Il peut sembler
anecdotique mais sa correction complète nécessite une refonte assez
profonde de Maven et de sa gestion du cycle de vie.

image:illustrations/MangaEmmanuel.png[float="left"]

Un autre souci concerne les expressions, qui permettent de mutualiser
des numéros de version comme dans l'exemple ci-après :

<groupId>org.springframework</groupId>

<artifactId>spring-jms</artifactId>

<version>$\{spring.version}</version>

En utilisant systématiquement cette propriété, nous pouvons être sûrs
que toutes nos références aux différents modules de spring utilisent une
même version cohérente, c'est donc bien pratique. Cependant, la
propriété spring.version peut être déclarée ailleurs dans le POM, mais
aussi dans son parent, dans un profil, dans le fichier settings de
l'utilisateur ou _via_ la ligne de commande. Si elle est déployée telle
quelle, comment pouvons-nous être sûrs qu'elle sera interprétée à
l'identique dans un contexte très différent ? En tant que responsable de
notre livrable, Emmanuel a dû se battre contre les comportements qui
dépendent de l'environnement. Une construction de projet fiable doit
être totalement reproductible.

La liste est encore longue des fonctionnalités manquantes, mal fichues,
des bogues et autres anomalies, et peu sont simples à traiter…

Sortons des limites liées au fonctionnement propre de Maven et
intéressons-nous à la norme OSGi qui connaît un intérêt croissant.
Celle-ci accompagne une archive Java (un bundle en terminologie OSGi) de
métadonnées dans un format propre, mais qui ressemblent beaucoup aux
concepts de dépendances de Maven.

Comment éviter de dupliquer l'information ou, du moins, comment assurer
la cohérence entre ces deux mondes ? Même constat pour la norme Java
modules qui fait l'objet d'une JSR et devrait être intégrée à Java 7
(JSR-277). Comment Maven gérera-t-il ces nouveaux formats qui viennent
marcher sur les plates-bandes de la gestion des dépendances, en
particulier le standard OSGi dont l'ordre de résolution des conflits
n'est pas exactement équivalent ?

Les plugins
^^^^^^^^^^^

image:illustrations/MangaOlivier.png[float="left"]

Olivier signale également la difficulté pour identifier un plugin qui
réponde à un besoin précis et pour en qualifier la pérennité. Or, Maven
ne vit que par ses nombreux plugins. Les besoins précis sont soit une
intégration d'une nouvelle technologie dans le build (comme GWT), soit
une optimisation du build propre à un projet (comme compiler, déployer
sur un serveur Tomcat tout en modifiant sa configuration…).

Le projet Apache Maven n'héberge officiellement qu'un nombre réduit de
ces plugins, utilisés pour sa propre construction ou pour des besoins
fondamentaux du développement Java. Il s'ensuit que les plugins, qui
sont finalement l’élément principal manipulé par l'utilisateur final,
sont plus ou moins laissés dans la nature, attendant le bon vouloir
d'une communauté hétéroclite. Le projet Mojo encourage un regroupement
visant à donner à ces plugins un cadre et une culture communautaire,
mais le développement reste peu structuré et dépend du temps libre ou
des intérêts des développeurs impliqués. De nombreux plugins peuvent
ainsi rester des années dans le bac à sable, zone de test permettant de
faire naître de nouvelles idées, sans passer à un état stable qui leur
donnerait une plus grande crédibilité.

Par ailleurs, de nombreux développeurs peuvent être tentés de créer leur
propre plugin en dehors de la communauté officielle Maven, et les
héberger sur SourceForge, GoogleCode ou en interne dans leur entreprise.
Ces efforts non coordonnés peuvent encourager une certaine créativité
mais laissent surtout passer l'occasion de construire une solution plus
viable avec un accueil plus large par la communauté des utilisateurs.

De manière plus générale, l'utilisateur qui ne trouve le plugin adéquat
pour un besoin donné ni dans ceux de Maven, ni sur la liste des plugins
stables de Mojo, est confronté à un choix délicat :

·     se laisser tenter par un plugin du bac à sable Mojo, en espérant
que son développement soit encore actif, et sans aucune garantie de voir
un jour une version stable en sortir ;

·     chercher en dehors de ces sources officielles un plugin adapté,
mais avec le risque de ne trouver que des solutions partielles sans
support et méconnues de la communauté ;

·     se lancer dans une solution interne, dont il faudra supporter le
coût de développement et qui ne bénéficiera pas de l'enrichissement
d'une communauté de centaines d'utilisateurs.

Info

Précisons que le projet Mojo est ouvert aux contributions et toujours
enthousiaste à accueillir des développeurs qui veulent prendre en charge
un plugin à l'abandon ou proposer leur propre travail à la communauté.
C'est en tout cas la politique que nous défendons, même si nous ne
sommes pas seuls à bord. N'hésitez pas à venir nous parler de vos
projets et envies sur la liste de diffusion : user@mojo.codehaus.org.

Le support
^^^^^^^^^^

image:illustrations/MangaVincentM.png[float="left"]

L'utilisation de Maven est simple si on suit ses conventions et qu'on
dispose des bons plugins ; elle peut devenir assez vite délicate, si on
n'a pas les bons réflexes, voire totalement insurmontable, si on tente
de plier Maven à des utilisations pour lesquelles il n'a pas été prévu.
Le support est donc un élément clé de son utilisation, et Vincent ne
manque pas de le souligner (la question allait venir d'elle-même de
toute façon). Il ne fait aucun doute que vous y aurez recours à un
moment ou un autre même en ayant lu avec attention les pages de ce
livre.

Le support de Maven est centralisé sur une liste de diffusion
(users@maven.apache.org) qui réunit ses utilisateurs et une majorité de
ses développeurs. Les messages y sont nombreux, touchent tous les
sujets, et les réponses viennent rapidement en raison du grand nombre
d'utilisateurs en ligne. Il n'y a cependant aucune obligation de
résultat et aucun moyen d'accentuer l'appel au secours, sauf à relancer
sa question au risque de se faire rejeter plutôt qu'aider par les
membres bénévoles.

Si vous faites appel à la communauté, pensez à poser des questions
précises en détaillant clairement votre besoin, votre environnement
(vous pouvez toujours lire ce petit guidelink:#_ftn49[[49]]), et
n'hésitez pas à répondre aux autres utilisateurs : nous avons tous
commencé de cette façon et c'est ainsi qu'on apprend le mieux à utiliser
Maven. La liste des utilisateurs de Maven a dépassé la taille critique
et s'autoalimente : les utilisateurs avertis aident les novices.
L'équipe des développeurs n'a plus besoin d'assurer elle-même le support
de premier niveau et peut donc se concentrer sur les développements et
les corrections.

Vous pouvez aussi retrouver une partie des développeurs du projet ainsi
que des utilisateurs sur l'IRClink:#_ftn50[[50]] (serveur
irc.codehaus.org, canal : #maven). Ce média a l'avantage d'être en
direct et peut donc vous apporter des réponses plus rapidement que la
liste de diffusion, si vous avez la chance de tomber sur les bons
interlocuteurs. Par contre, contrairement à cette dernière, comme il
n'est pas possible d'accéder aux discussions qui ont eu lieu pendant une
déconnexion, n'espérez pas qu'une personne vous réponde si elle n'était
pas là au moment où vous avez posé votre question. Enfin, n'oubliez pas
qu'il y a beaucoup de personnes dans l'équipe Maven qui ne sont pas sur
le même fuseau horaire que nous. N'espérez pas contacter les membres
outre-Atlantique le matin heure française.

Seule contrainte : tous ces échanges se font en anglais, parfois avec
une syntaxe qui doit désespérer ceux dont c'est la langue maternelle.
Heureusement, les francophones sont réputés pour leur compétence en
langues étrangères ;). Si, malgré tout, ce n'est pas votre cas, le site
developpez.com héberge un forum francophone consacré à
Mavenlink:#_ftn51[[51]], ainsi qu'une FAQlink:#_ftn52[[52]] bien
remplie.

Le coût de Maven
^^^^^^^^^^^^^^^^

image:illustrations/MangaHerve.png[float="left"]

Hervé rebondit sur la question du support en évoquant le prix de revient
de Maven sur un projet. Maven est un projet libre, téléchargeable et
utilisable gratuitement. Son coût d'utilisation n'est cependant pas nul,
comme tout projet open-source. Le simple fait que vous ayez ce livre
entre les mains est déjà un élément de réponse : il n'est pas si facile
à utiliser et nécessite un certain apprentissage. Il ne s'applique pas à
n'importe quel projet et sans un certain effort d'organisation. Il
nécessite donc un minimum d'expérience. Les sociétés de services ne s'y
sont d'ailleurs pas trompées et vendent consultants et formations autour
de ce sujet.

Comme de nombreux outils, Maven coûte bien plus cher par la formation
qu'il induit que par son prix d'achat (qui est particulièrement
attrayant dans le cas d'un projet libre). Sa documentation en ligne est
perfectible mais elle est épaulée par de nombreuses autres sources. Ce
livre fait partie de cet effort et vient compléter les livres _Better
Builds with Maven_link:#_ftn53[**[53]**] et _Maven – the definitive
guide_, bible de 500 pages qui présente tous les aspects de Maven, sans
compter les innombrables blogs, articles, forums et tutoriels qui
décrivent des points plus spécifiques de son utilisation.

La concurrence
~~~~~~~~~~~~~~

image:illustrations/MangaVincentS.png[float="left"]

Après cette autocritique, Vincent prend en main la contre-attaque :
quelle autre solution avons-nous pour la gestion de notre projet ? Nous
avons évoqué Ant au Chapitre 1, mais la concurrence à laquelle Maven
s'expose ne s'arrête pas là. Certains outils ont d'ailleurs capitalisé
sur les bonnes pratiques reconnues de Maven et ont tenté de créer une
nouvelle solution plus productive sur cette base.

Cette émancipation, bénéfique à tous, est encouragée par les
développeurs de Maven, même s'ils acceptent forcément assez mal les
critiques si elles ne sont pas enrobées par la politesse et les
justifications nécessaires. Un outil, en particulier open-source, ne
peut pas tenir ses utilisateurs en otage. Il est contraint à
l'excellence pour occuper le dessus du panier. Les critiques, plus ou
moins constructives ou honnêtes, sont inévitables mais doivent toujours
être considérées avec attention.

Maven bon partout ?
+++++++++++++++++++

Nous avons tenté au cours des chapitres précédents de vous démontrer en
quoi l'approche proposée par Maven est d'un niveau supérieur au simple
script de construction de projet. Il faut cependant admettre que Maven
n'est pas bon partout et mal adapté à certains projets.

Maven part du principe que 99 % des projets ont des besoins comparables
et peuvent s’appuyer sur les mêmes outils et bonnes pratiques s'ils
acceptent des conventions communes. Il reste cependant 1 % de projets
qui ont des besoins vraiment très spécifiques – tout le monde dira que
son projet est différent des autres, mais soyons honnêtes, à part
quelques cas extrêmes, nous faisons tous plus ou moins la même chose.
Nous pourrions comparer la standardisation de la construction à celle du
démarrage : qui de nous a besoin d'une JVM customisée avec 12 paramètres
en "-XX:" pour lancer son application ?

Google Web Toolkit rentre dans les projets "spécifiques". La compilation
des sources doit marier du code natif pour Windows, Linux et Mac OS,
l'inclusion de code source Java dans l'archive JAR, et bien d'autres
subtilités. Construire un tel projet avec Maven serait possible, mais il
faudrait alors considérer la plus-value qu'il apporterait aux
développeurs. Le mécanisme de test de ce projet est ultra-spécifique,
les artefacts construits – si, au final, ils sont des archives JAR –
sont composés d'éléments peu courants. La configuration nécessaire dans
Maven pour obtenir un résultat convaincant serait significative. Ce
projet ne rentre pas dans le cadre des 99 %.

Spring 2 a lui aussi choisi de ne pas utiliser Maven pour sa
construction. Pour ce projet devant mixer la compilation de classes
destinées à Java 1.4 et Java 5, en plus de divers raffinements dont la
compatibilité OSGi, il faut bien reconnaître que Maven se serait assez
mal prêté au jeu.

Enfin, d'autres projets de développement basés sur des outils
propriétaires ou non (pensons à Liferay ou Alfresco) imposent
généralement leurs propres scripts de compilation et donc ces types de
projets rentrent, là encore, dans le 1 %.

Maintenant, nous ne sommes pas nombreux à travailler sur des projets
aussi particuliers. Cela n'interdit pas de regarder ce qui se fait
ailleurs pour déterminer si Maven est le meilleur choix. Il est
intéressant de noter que Spring 3 sépare ses packages principaux en
modules dédiés et intègre même un fichier POM
expérimentallink:#_ftn54[[54]].

This POM cannot be used to build Spring; it is a work in progress and
should only be used as part of a Maven repository upload bundle using
artifacts created by the spring build system.

Comme quoi, l'idée fait tout de même son chemin…

Ant et Ivy
++++++++++

Nous avons déjà parlé d’Apache Ant, qui a été longtemps le standard de
fait pour la construction de projets en Java. Ivy est un projet qui lui
apporte une gestion des dépendances très proche de ce que Maven propose
– Ivy sait d'ailleurs exploiter les POM de Maven et ses dépôts de
bibliothèques. Le couple Ant + Ivy permet donc de faire globalement la
même chose que Maven pour ce qui est de la gestion des bibliothèques.

Par contre, cela n'apporte rien en termes d'homogénéité des projets, de
conventions d'organisation du code ou de réutilisation des scripts Ant.
Ivy apporte à Ant une fonctionnalité clé de Maven mais ne change en rien
sa philosophie générale. La comparaison entre Ant et Maven ne doit pas
se faire en comptant le nombre de lignes de XML nécessaires pour
compiler des classes, mais en fonction de l'esprit général de l'outil et
de ce qu'il apporte ou impose sur un projet.

On peut faire le choix d’Ant, de la liberté qu'apporte un langage de
script pour faire à peu près tout ce qu'on veut. Il ne faudra alors pas
s'étonner que cette liberté ait un prix en maintenance et en évolutivité
du projet.

EasyAnt
+++++++

EasyAntlink:#_ftn55[[55]], comme son nom le suggère, vise à simplifier
l'utilisation d’Ant. Il propose une surcouche qui intègre Ivy et un
certain nombre de conventions, permettant de passer des commandes de
construction sans avoir à établir une configuration répétitive d'un
projet à l'autre. Un mécanisme de plugins permet de préparer des
fragments de script Ant pour être partagés entre projets.

L'approche est intéressante dans le sens où elle rejoint le constat qui
est à l'origine de Maven : des projets comparables doivent sans cesse
réécrire la même configuration, alors qu'ils vont dérouler globalement
les mêmes procédures. EasyAnt n'est cependant pas aussi easy qu'il le
prétend si l'on considère qu'il exploite les namespace dans un langage
de script XML, ce qui n'est pas d'une grande lisibilité pour le
développeur novice. De ce point de vue, Gradle est nettement plus
innovant.

Gradle
++++++

image:illustrations/MangaGregory.png[float="left"]

Depuis des mois déjà, Grégory nous interpelle sur notre projet en
dénonçant la lourdeur du fichier XML de notre outil de build et son
manque de flexibilité. Lui voudrait bien imposer Gradle, son outil de
prédilection.

Gradlelink:#_ftn56[[56]] s’appuie lui aussi sur Ant et Ivy, et met en
place un esprit de construction par conventions. Basé sur Groovy plutôt
que XML, un script Gradle manipule des tâches Ant traditionnelles qui
sont ses briques de base. Groovy est mis à contribution pour créer un
Domain Specific Language (DSL), un langage de programmation dédié à une
tâche particulière : la construction de projet. L'intégration d'Ivy dans
Gradle se fait _via_ ce DSL plutôt que par les tâches Ant Ivy, ce qui
simplifie sa manipulation.

Gradle définit également la notion de plugin, plus ou moins comparable
avec la signification de ce terme dans Maven. Un plugin Gradle est
plutôt un ensemble de conventions, tâches et extensions Gradle réunies
et réutilisables sur plusieurs projets.

Le Listing 15.x donne un exemple de script Gradle que nous présente
Grégory pour la mise en place d’un projet Java. La syntaxe est
particulièrement compacte.

Listing 15.x : Un script simple de build Gradle

usePlugin 'java'

 

sourceCompatibility = 1.5

version = '1.0'

manifest.mainAttributes(

    'Implementation-Title': 'Gradle Quickstart',

    'Implementation-Version': version

)

 

repositories \{

    mavenCentral()

}

 

dependencies \{

    compile group: 'commons-collections', name: 'commons-collections',
version: '3.2'

    testCompile group: 'junit', name: 'junit', version: '4.+'

}

 

test \{

    options.systemProperties['property'] = 'value'

}

 

uploadArchives \{

    repositories \{

       flatDir(dirs: file('repos'))

    }

}

Nous ne rentrerons pas plus en détail dans Gradle, dont la documentation
en lignelink:#_ftn57[[57]] est très complète si cette alternative vous
intéresse. Gradle reprend beaucoup d’éléments de Maven en termes de
conventions plutôt que configuration, cycle de vie, approvisionnement à
partir de dépôts, plugins … Par contre, Gradle réhabilite en même temps
le concept de scripting, permettant d’embarquer des tâches spécifiques
dans le build. Par ailleur, Gradle est un outil encore très jeune et
disposant de peu de plugins (comparé à l’écosystème Maven ou Ant), aussi
l’écriture de scripts est quasiment nécessaire pour en tirer quelque
chose.

 

En tant qu'anciens de la communauté Maven, autant EasyAnt que Gradle
nous rappellent énormément une vieille connaissance : Maven 1.

Maven 1
+++++++

Maven 1 avait pour objectif de fournir au-dessus d’Ant une gestion de
dépendances (Ivy n'existant alors pas encore) et une approche par
conventions. Il utilisait des fichiers de script XML basés sur Ant et
sur un langage de programmation XML (jelly). Les tâches les plus
courantes étaient regroupées dans des plugins, qu'on pouvait importer et
invoquer dans les projets.

Maven 1 a eu ses heures de succès en démontrant les apports de la
standardisation, puis a montré ses limites quand les scripts des plugins
ont commencé à se complexifier pour éviter des effets de bord et des
interactions mutuelles. Ce demi-échec a été à l'origine de Maven 2,
construit sur un modèle nettement plus robuste.

Le concept mis en œuvre dans EasyAnt nous semble ainsi obsolète, car
nous avons déjà exploré cette voie et rencontré des obstacles bien
délicats à franchir.

 

Notre avis concernant Gradle est plus ambigu ; construit sur des outils
modernes, avec une syntaxe claire et compacte, il partage avec Maven
certains concepts forts. La syntaxe de Gradle est compacte, claire et
très spécialisée grâce à Groovy et à sa capacité naturelle à construire
des DSL. Grégory nous promet monts et merveilles, nous démontre
l’extrême richesse du DSL Gradle à travers quelques exemples bien
choisis, pour lesquels l’outil est effectivement nettement moins verbeux
que Maven, mais n’arrive pas à nous convaincre.

En ouvrant la boite de pandore du langage de script, même avec un
fonctionnement « par défaut » proche de ce que propose Maven, Gradle
vous tend la perche pour accumuler les astuces et autres bizareries qui
font de votre projet une usine à gaz, rien que pour produire le
livrable. Dans le même esprit, Maven propose depuis ses début un plugin
permettant d’exécuter des tâches Ant ou Groovy, mais ces « astuces » ne
sont considérées que comme un pis-aller pour faciliter une migration
rapide vers Maven le temps de trouver une solution plus propre.

Buildr
++++++

Apache aime bien développer des outils de build ! En plus de Maven et
d'Ant, il existe aussi le projet Buildrlink:#_ftn58[[58]], se
positionnant dans l'organisation des projets comme Maven. Il utilise le
langage Ruby au lieu du XML, les conventions de Maven et s'intègre avec
Ant et les dépôts Maven.

Nous ne détaillerons pas ce dernier candidat, sachant que nous en avons
laissé d’autres en retrait, nombreux, qui se proclament tous aussi
révolutionnaires et intuitifs les uns que les autres. Rappelons
simplement l'un des reproches le plus souvent faits à Maven : l'absence
d'une bonne intégration sous Eclipse. Si on considère les autres
solutions, l'intégration est quasi inexistante ou limitée au lancement
des tâches de construction. Reste comme seul argument la syntaxe XML du
fichier POM, argument parfaitement recevable mais qui est un peu court
pour sélectionner un outil aussi important pour un projet.

Un outil reconnu
~~~~~~~~~~~~~~~~

Il existe donc de nombreux concurrents face à Maven, alors pourquoi le
choisir a priori plutôt qu'une autre ? Un élément de réponse simple se
trouve dans la maturité de l'outil et la taille de sa communauté, ou
plutôt dans son niveau de pénétration en entreprise, comme toute
évaluation de projet open-source. Il sera plus facile de trouver
rapidement des personnes compétentes sur un outil largement utilisé,
même s'il est imparfait, que de galérer avec un bijou technologique que
trois personnes au monde savent faire fonctionner.

La communauté
^^^^^^^^^^^^^

image:illustrations/MangaArnaud.png[float="left"]

Arnaud poursuit le travail d'évangélisation en démontrant que nous ne
sommes pas de dangereux geeks qui ont misé sur un outil qui finira aux
oubliettes dès que la mode sera passée.

Maven ne vit qu'au travers de la communauté de ses utilisateurs, qui
assurent l’essentiel du support de l'outil. Les développeurs ne sont
plus eux-mêmes mis systématiquement à contribution vu la très large base
d'utilisateurs avancés qui participent activement aux discussions en
ligne. La Figure 15-01 présente le nombre d'utilisateurs de la liste
users@maven.apache.org ainsi que le nombre de messages par jour. Cette
liste est très active et répond aux nombreuses questions de toute nature
que les utilisateurs de tous niveaux formulent, parfois dans un anglais
assez approximatif (c'est un moyen simple pour reconnaître des collègues
francophones).

Figure 15-01

Trafic de la liste users@maven.apache.org – en rouge le nombre de
messages et en bleu le nombre d'inscrits.

Autre indicateur, le trafic sur le site web maven.apache.org. Les
Figures 15-02 et 15-03 affichent le compte rendu des visites pendant un
mois, ce qui donne une bonne idée du nombre d'utilisateurs de Maven
amenés à configurer leurs plugins (le site web étant la principale
source d'information sur cet aspect). La Figure 15-04 indique le nombre
de téléchargements de Maven au cours de l'année, toutes versions
confondues. Ici encore, les chiffres démontrent une très large
communauté.

Figure 15-02

Origine géographique des visiteurs de maven.apache.org.

Figure 15-03

Trafic sur le site web maven.apache.org.

Figure 15-04

Téléchargements mensuels de Maven sur un an, toutes versions confondues.

Si vous choisissez Maven, vous ne serez donc pas tout seul et vous
trouverez rapidement des collègues utilisant le même outil. Nous avons
peut-être tous tort par rapport à une autre solution parfaite ou
presque, mais au moins nous pouvons nous serrer les coudes et avancer
ensemble.

L'équipe de développement
^^^^^^^^^^^^^^^^^^^^^^^^^

Arnaud poursuit en présentant le cœur du projet Apache Maven, ceux qui
le développement et dont nous dépendons au final.

Maven, c'est aujourd'hui 55 développeurs, dont une bonne vingtaine très
actifs en 2009, et une très longue liste de contributeurs qui rapportent
des bogues, proposent des correctifs ou discutent des évolutions. Maven,
c'est surtout un très large choix de plugins qui impliquent tout autant
de développeurs de toutes origines.

Cette équipe motivée est à l'origine de plusieurs ouvrages, dont celui
que vous tenez entre les mains, auquel vous pouvez ajouter le Definitive
Guide et Better Build with Maven, tous deux disponibles en ligne
gratuitement, et Apache Maven 2 Effective Implementations, proposé en
ligne, chapitre par chapitre, au fur et à mesure de sa rédaction.

Limité au monde francophone, Maven c'est encore dix membres bien de chez
nous qui ont participé à cet ouvrage en corrigeant nos erreurs. C'est
aussi une volonté de communiquer avec les utilisateurs, comme l'a
démontrée notre présence active dans les Java User Groups.

Maven est donc un projet très dynamique, et si les versions ne
s'enchaînent pas aussi vite qu'on pourrait le désirer, c'est surtout
parce que la qualité de nos livrables est constamment améliorée et
qu’une politique très scrupuleuse (et très complexe) de compatibilité
avec l'existant est suivie.

L'adoption en entreprise
^^^^^^^^^^^^^^^^^^^^^^^^

image:illustrations/MangaJerome.png[float="left"]

Votre Honneur, j'appelle à la barre notre premier témoin : Jérôme.

Jérôme a testé Maven suite à nos recommandations pour lancer une
nouvelle application et former son équipe. Il est en quelque sorte notre
cobaye pour valider l'adoption de Maven sur d'autres projets.

Pourquoi Maven réussit-il une percée en entreprise ? Nous l'avons vu au
cours des chapitres qui ont précédé, Maven est un fédérateur d'outils.
La même ligne de commande permet de construire n'importe quel projet
Maven bien configuré.

Quel chef de projet ne rêve pas de pouvoir affecter un nouveau
développeur dans l'urgence sans devoir perdre dans le même temps une
ressource, le temps de lui expliquer toutes les ficelles du projet ?
Avec des projets correctement construits avec Maven, le passage d'un
projet à un autre se résume à un checkout depuis le gestionnaire de code
source. Jérôme abonde dans ce sens en expliquant comment nous avons pu
lui apporter une aide rapide en jetant juste un rapide coup d'œil sur
son projet. _Via_ une structure comparable, il est plus facile de
s'approprier en peu de temps un projet développé ailleurs.

Jérôme souligne ensuite les bonnes pratiques que véhicule Maven : une
gestion stricte des dépendances, des tests qui font corps avec le
développement et non comme tâche à part, l'intégration des outils de
qualité logicielle, le support de l'intégration continue, etc. Pour
avoir trop souvent piloté des projets peu scrupuleux et réalisés sans
filet, reposant sur les épaules de quelques personnes, il apprécie
d'avoir enfin un cadre solide et homogène.

En entreprise, Maven est un élément clé de ce socle qu'on appelle
software factory, qui vise à proposer une solution industrialisée,
reproductible et stabilisée pour les développements logiciels, sortant
de plusieurs décennies de bricolage. Jérôme, en s'inspirant de notre
exemple, est en train de mettre en œuvre le même type d'outillage et
bénéficie des infrastructures que nous avons déjà mises en place :
gestionnaire du dépôt d'artefacts, serveur d'intégration continue.

L'avenir de Maven
~~~~~~~~~~~~~~~~~

image:illustrations/MangaJIM.png[float="left"]

Mission impossible ?

Bonjour, Monsieur Phelps. Votre mission, si vous l'acceptez, est de
présenter à nos lecteurs l'avenir de Maven. Comme tout projet
open-source, son développement n'est guidé par aucun plan gravé dans le
marbre et toute annonce préliminaire peut être contredite par les faits.
Pour éviter à nos lecteurs de se bâtir une opinion sur des informations
erronées, prenez soin d'annoter les données les plus spéculatives de
votre logo Impossible Mission Force.

Si vous ou l'un de vos agents était capturé ou tué, les auteurs
nieraient avoir eu connaissance de vos agissements. Bonne chance, Jim…

Cet encadré s'autodétruira dans dix secondes… PChittttttt !

 

Maven 2.x
^^^^^^^^^

Maven 2 ne bénéficiera au mieux que de quelques versions correctrices,
et encore sous réserver que des développeurs prennent le temps de se
pencher à son chevêt ! Maven 3.x est la branche active qui bénéficie de
toute l’attention de l’équipe.

Les équipes qui utilisent Maven 2.x seront encore nombreuses, soit pour
des raisons d’incompatibilité sur un projet ancien, soit par
méconnaissance de la compatibilité des versions successives de Maven (ou
par manque de temps pour s’en assurer). Quelle que soit la raison qui
vous pousse à continuer d’utliser Maven 2.x, n'attendez rien de nouveau
de ce côté. Cependant, pour nos lecteurs qui serait contraint à cette
version pour une raison qui leur appartient, un rapide état des lieux :

Maven 2.1
+++++++++

Maven 2.1 a été la première version à profiter de cet élan. Les
nouvelles fonctionnalités qu'il apporte peuvent sembler superficielles
mais l'importance est avant tout le redémarrage de cette branche de
développement en parallèle de Maven 3. Maven 2.1 introduit :

·     La possibilité de sécuriser les mots de passe définis dans le
fichier settings.xml de l'utilisateur, et donc un peu trop ouvertement
exposés aux regards indiscrets. Ceux-ci peuvent désormais être chiffrés
et la clé stockée, par exemple, sur une clé USB et donc inexploitable en
l'absence de son utilisateur légitime (pensez au cas de vol de
l'ordinateur portable d'un développeur Maven, un quidam pourrait venir
l'enrichir et le corriger à nos dépens J).

·     Le téléchargement des dépendances en parallèle. Cela n'a pas un
grand intérêt pour le développeur qui ne va télécharger ses dépendances
qu'une seule fois – quoique, lors de la première utilisation, quand
Maven "télécharge la moitié d'Internet", cela puisse se sentir. Sur un
serveur d'intégration continue, par contre, si on désire utiliser un
dépôt local vierge avant chaque construction pour faire les choses bien
proprement, le gain de temps peut être significatif.

·     La construction multimodule par morceaux. Il est possible de
demander à Maven 2.1 de ne construire que certains modules du projet, et
éventuellement tous les modules dont il dépend ou encore tous les
modules qui dépendent de lui. Cette fonctionnalité était déjà présente
sous forme d'un plugin dédié reactor, elle est désormais disponible au
cœur de Maven.

·     Sans oublier une nette amélioration des performances sur
l'initialisation de Maven dans un contexte avec de nombreux modules.

Maven 2.2
+++++++++

Deuxième de la lignée, Maven 2.2 est apte à :

 

·     Corriger plusieurs bogues, dont un lié à la manipulation des
$\{variables} lorsque le POM est installé dans le dépôt local ou
déployé. Cette fonctionnalité introduite dans Maven 2.1.0 a entraîné des
régressions sur certains plugins, notamment celui de signature GPG –
elle a donc été retirée au profit d'une gestion plus stricte.

·     Apporter quelques améliorations mineures.

C'est tout ? Ça fait un peu maigre, même pour une version mineure. On
dirait plutôt une petite version corrective ! La raison principale de ce
changement de version est que Maven 2.2 nécessite désormais Java 5. La
compatibilité avec Java 1.4 a été longtemps conservée pour ne pas
déranger les utilisateurs, Java 5 est nécessaire pour corriger certains
bogues. Cela n'interdit pas de construire des projets pour Java 1.4,
voire des versions antérieures, mais le poste de développement doit
disposer d'un JDK 5 pour exécuter Maven lui-même.

 
+

Maven 3.x
^^^^^^^^^

[MAVEN3]

Maven 3 a longtemps été connu sous le nom de Maven 2.1. Son
développement correspond à une refonte profonde du cœur de Maven,
travaux importants menés de manière très active par l'équipe de
Sonatype, société fondée par Jason Van Zyl, développeur initial de
Maven. Cette reprise lourde du code a, dans un premier temps, paralysé
les évolutions sur Maven 2.0 car tout le monde attendait plus ou moins
la suite. Les choses ne vont cependant jamais assez vite et
l'ex-Maven 2.1 a été renommé Maven 3.x pour bien indiquer la rupture et
laisser de la place pour de nouvelles versions de Maven 2.

 

L'un des plus gros chantier de Maven 3, et qui explique en grande partie
son retard, est la compatibilité avec l'existant. Un ensemble de tests
d'intégration a été écrit pour mettre en scène Maven confronté à la
plupart de ses cas d'utilisation. Projets simples, multi-modules,
plugins plus ou moins complexes, sont ainsi exécutés en boucle par un
harnais de sécurité anti-régression de plus de 450 tests. Ce n'est pas
une garantie absolue, mais c'est une sécurité que peu de projets peuvent
proposer.

 

La seconde difficulté dans le développement de Maven 3 touche à la
pérennité des API internes de Maven, utilisées par certains plugins, et
que l'équipe de développement voudrait pouvoir retravailler. La limite
entre public et interne dans Maven 2 est en effet assez floue, et pour
traiter certains besoins particuliers, les développeurs de plugins ont
parfois fait appel à du code assez profond de Maven 2. Sonatype a donc
développé une couche de traduction entre les API historiques de Maven 2
et leur équivalent dans le code modernisé de Maven 3.

 

En résumé, Maven 3 c’est un peu un épisode spécial de Extreme makeover :
Maven editionlink:#_ftn59[[59]].  On prend votre outillage existant,
mais on refait tout de la cave au grenier !

$$$ centré $$$Figure 15-05

Quoi de neuf ?
++++++++++++++

Le changement le plus notable dans Maven 3 est la possibilité de
l'intégrer dans un autre outil. Ceci ouvre la voie à de nombreuses
utilisations en dehors de la ligne de commande classique que nous avons
rencontré jusqu’ici.

Maven 3 peut être intégré au sein d’un autre outil, et c’est ce que font
nos IDE. Disposer d’un Maven « embarqué » leur permet de manipuler le
POM, le cycle de vie, les plugins, et l’arbre de dépendance.  Maven 3
peut ainsi se greffer à la construction incrémentale d’un projet
Eclipse, c’est à dire ne procéder  à la reconsturction du projet que
pour les parties impactées par la dernière modification pour plus de
réactivité. Lorsque vous éditez un fichier source, l’IDE ne va pas
reconstruire tout l'espace de travail en effaçant tout l'existant, mais
travailler par différence avec ce qui était déjà construit et juste
recompiler ce qui est impacté par votre modification. Avec la gestion de
la construction incrémentale et une bonne gestion du Maven intégré, il
est  possible de laisser l'IDE faire certaines de ces tâches tout en
exploitant les plugins Maven pour d'autres, comme c'est déjà le cas pour
la compilation du code source.

[image:illustrations/MangaOlivier].png[float="left"]

Olivier nous signale d’ailleurs que notre IDE n’est pas le seul à
exploiter cette possibilité d’embarquer Maven en interne. Notre serveur
d’intégration continue fait de même ! En pouvant manipuler Maven comme
un composant interne, Hudson peut lui greffer ses propres extensions et
proposer une intégration fine. Les builds Maven qu’il exécute sont alors
mis sous surveillance et Hudson peut nous indiquer l’avancement de
chaque module du projet.

Mais ce ne sont que quelques exemples. L’intégration de Maven permet de
construire des outils innovants, comme le shell Maven proposé par
sonatype. Au lieu de la console de base de votre système, MavenShell
propose une console avec coloration syntaxique, assistance à la saisie
des mots clés, et maintien en mémoire des POM et des métadonnées de
votre projet. Il en résulte un Maven plus réactif à vos commandes.

Figure 15-06

Sonatype MavenShell.

Maven 3 offre la possibilité pour le POM d'utiliser un format
alternatif. Nous avons vu que le format XML actuel est particulièrement
verbeux ; Polyglot Maven est une version dérivée de Maven, développée
par Sonatype, visant à proposer une syntaxe différente du POM, basée par
exemple sur Groovy, Clojure, ou Scala – pour exprimer les mêmes
métadonnées, comme le monte le Listing 15.1. Attention cependant,
l’outillage avancé permettant d’éditer le POM dans votre IDE n’est pas
compatible avec cette syntaxe.

Listing 15.1 : Un POM Maven 3 exprimé en Scala

// pom.scala

project( "com.macompagnie:monprojet:1.0-SNAPSHOT" \{ proj =>

   // ajoute la bibliothèque scala et le plugin scala compiler

   proj includeScalaSources "2.7.7"

 

   proj dependency "apache-httpclient:commons-httpclient:3.0.1"

}

Cette écolution vise un public très précis: ceux qui n’utilisent pas
Maven mais travaillent dans un langage de développement tournant sur la
JVM. En leur proposant d’exprimer le POM dans leur langage et avec les
possibilities d’extension qui lui sont propres, Polyglot essaie de
couper l’herbe sous le pied des outils alternatifs.

Maven 3.1
+++++++++

[IMF]

Maven 3 permet de désolidariser Maven (l’outil) de la lecture du moèle
POM : l’élément modelVersion va pouvoir jouer son rôle et permettre
d’introduire des évolutions dans ce format, sans empêcher les
tuilisateurs de l’utiliser depuis une autre version de Maven – il
suffira d’obtenir depuis le dép*ô*t la version associée du modèle. On
attend ainsi la simplification de certaines opérations pénibles sur les
POM, comme l’exclusion globale d’un artefact (plutôt que de devoir
répéter des dizaines de fois le même bloc exclusions.

 

Autre évolution prévue de longue date : les mixins. Ils vont permettre
de récupérer une configuration maven depuis un fichier POM sans passer
par un héritage. La composition d’un POM se fera alors par composition
de mixins ; un mixin pour la gestion de la persistence Hibernate, un
mixin pour la gestion de l’application web, un mixin pour notre
outillage Q&A, etc.

 

En parallèle du développement de Maven 3.x, Sonatype développe une offre
globale de forge logicielle, incluant le build, l’intégration continue,
l’hébergement des binaires, l’approvisionnement des plateformes de
développement et la mise en production. De nombreuses évolutions dans
Apache Maven seront donc issues de ces développements.

 

Sonatype Maven
++++++++++++++

Sonatype a annoncé lors de la conférence EclipseCon 2011, par la voix de
Jason van Zyl son responsable technique et fondateur, ses projets pour
le développement de son offre autour de Maven, Eclipse et Hudson. La
diapo présentée en figure 15-06, extraite de cette présentation, définit
la position de Sonatype par rapport au projet Apache Maven. La fondation
Apache utilise un gestionnaire de code source Subversion, qui est
intégré en mirroir sur un compte GitHub. Sonatype utilise
l’impressionnante puissance de Git pour assurer la synchronisation de
ses développements internes avec la version open-source Apache. Cela va
permettre à Sonatype de poursuivre ses objectifs d’innovation et
d’avancer au rythme qu’il désire imposer au projet, tout en conservant
le lien avec le projet et le mode de fonctionnement de la fondation
Apache. Aisni, si ces annonces concernent avant tout les outils de
Sonatype, dont certains sont disponibles en double licence open-source /
propriétaire, une partie sera reversée à la communauté et viendra
enrichir le socle technique Maven.

 

Figure 15-07

le positionnement de Sonatype par rapport au projet de la fondation
Apache

 

Pour ce qui concerne Maven, l’éditeur affiche ses ambitions :

D’une part, la généralisation de l’utilisation des annotations Java5 et
de l’injection de dépendance JSR-330. Nous l’avons déjà croisé au
chapitre 11 lorsqu’Olivier est venu dépoussiérer le code de notre
plugin.

La norme JSR-330 est intégrée à JavaEE 6 et apporte à la pile Java
d’entreprise l’injection de dépendance démocratisée par le succès de
SpringFramework. Cette norme va rapidement devenir la référence sur le
sujet, déjà supportée par Spring 3 et Google Guice même en dehors du
contexte JavaEE. L’idée de Sonatype est de capitaliser sur ce succès en
appliquant ce modèle aux plugins Maven, ainsi qu’à ses autres outils que
sont Nexus et Hudson. On retrouvera ainsi dans tous nos développements
la même logique de liaison entre les composants via une simple
annotation @Inject.

[IMF]

Autre annonce, un gros effort d’intégration de Maven dans Eclipse à
travers le projet m2eclipse. En dehors de l’amélioration du plugin, de
son ergonomie et de ses fonctionnalités, Maven peut évoluer pour mieux
supporter le mode incrémental d’Eclipse, à savoir ne plus partir de zéro
à chaque nouveau build. L’IDE pourrait tirer partie de ces évolutions,
mais aussi tout l’écosystème Maven. L’intégration continue pourrait par
exemple elle aussi utiliser un build incrémental pour plus de
réactivité.

Sur la gestion des dépendances et l’accès aux dépôts, Sonatype a déjà
pris la main en intégrant dans Maven 3 sa brique Aether. Développée sous
licence Eclipse dans les labos Sonatype, celle-ci remplace intégralement
le code équivalent de Maven 2. De nombreuses évolutions sont attendues
sur ce composant :

[IMF]**

·     Le support des accès concurrents dans le dépôt local. Cela est
nécessaire pour permettre l’exécution parallèle de Maven et des autres
outils basés sur Aether.

·     L’intégration avec m2eclipse, ce qui signifie le support dans
Aether des dépôts OSGi P2 d’Eclipse et le modèle de version associé.
Cette évolution permettra a termes de créer des passerelles entre les
deux grands modèles de dépôts d’artefacts et d’approvisionnement de
bibliothèques du monde Java. Avec le projet JigSaw (« java modules »)
qui vise à intégrer cette fonctionnalité directement dans la plateforme
Java, ce chantier risque de faire couler beaucoup d’encre.

·     Utiliser un client HTTP asynchrone permettant à Aether de mieux
communiquer avec les dépôts distants. En parallélisant les requêtes,
Aether peut répondre plus rapidement aux demandes de résolution des
dépendances. Plutôt que de démarrer de nombreux processus, les
entrées/sorties asynchrones permettent d’utiliser juste ce qu’il faut de
ressources.

·     Une dérivation du client HTTP asynchrone dédiée à Maven, utilisant
l’API Wagon définie par Maven pour le déploiement d’artefacts dans un
dépôt. Cette API remonte à Maven2 et a été dérivée pour supporter HTTP,
SCP, WebDav, FTP, les partages windows SMB et même SVN ! Plutôt que de
réinventer une nouvelle API, Sonatype préfère conserver cette façade et
travailler sous le capôt pour en améliorer les performances.

Sonatype prévoit aussi d’autres évolutions, sous forme de points
d’extension et de modèle événementiel, inspiré par les besoins
d’intégration de m2eclipse. Il ne s’agit évidemment que des plans
annoncés, qui peuvent évoluer et s’enrichir en fonction du contexte et
des difficultés que rencontreront les équipes de développement.

Maven 4 ?
+++++++++

image:illustrations/MangaArnaud.png[float="left"]

 [IMF]**

Arnaud est tout émoustillé par ces nombreuses annonces, et décide de se
lancer à son tour dans le jeu des prédictions. Il nous annonce alors la
fusion des projets Apache Maven et Gradle, prenant la rigueur du premier
et la syntaxe moderne du second, et nous présente le tout premier écran
de Graven, l’outil de build ultime. Hum… décidément, tout le monde ne
peut pas faire partie de l’équipe de Mission Impossible

Figure 15-08

Graven, une création originale d’Arnaud visant à marier Maven et Gradle

À qui appartient Maven ?
~~~~~~~~~~~~~~~~~~~~~~~~

Le comité est presque convaincu mais il a tout de même quelques
réticences. L'outil semble bon, promis à un bel avenir, mais dans les
mains de qui mettons-nous l'avenir de ce qui est en train de devenir le
projet n^o^ 1 de Geegol ?

La fondation Apache
^^^^^^^^^^^^^^^^^^^

image:illustrations/MangaRaphael.png[float="left"]

Raphaël se fait un plaisir en expliquant le monde open-source et les
garanties intrinsèques qu'apporte ce modèle.

Maven est l'un des nombreux projets hébergés par la fondation Apache,
surtout connue pour son excellent serveur HTTP (à tel point qu'on parle
souvent d'un serveur apache, sans plus de précision). Cette fondation
assure par son statut l'indépendance des projets hébergés vis-à-vis d'un
éditeur et encourage le développement communautaire.

Un projet Apache est conduit par un comité de pilotage, pour lequel
chaque membre dispose d'un droit de veto sur les décisions prises, et où
chaque décision majeure doit être soumise au vote et obtenir au moins
trois avis favorables. Cette règle de conduite assure la stabilité des
projets et le soutien de ses membres majeurs. Les autres membres du
projet, qui ne font pas partie du comité et ne disposent pas d'un droit
de veto, peuvent exprimer leur avis librement lors des votes. Il est
rare que la décision finale ne soit pas le reflet d'un compromis accepté
par tous.

Maven s'est développé dans cet esprit, chaque grande décision étant
soumise à la communauté des développeurs et reflétant leurs choix
communs. Au sein de la fondation Apache, il n'y a donc pas de
propriétaire du projet, en dehors du comité dont les membres ont des
attaches très variées.

C'est une distinction notable par rapport à d'autres projets open-source
dont les décisions ne sont pas si ouvertes. SpringFramework, par
exemple, est un projet ouvert aux suggestions de ses utilisateurs et
dont le code est libre, mais dont le développement est géré par la
société SpringSourcelink:#_ftn60[[60]]. L'excellente équipe de
développeurs que SpringSource a réussi à réunir propose un outil de
grande qualité, tandis que le soin apporté pour répondre aux rapports
d'anomalies et aux suggestions de la communauté d'utilisateurs est
exemplaire. L'ouverture de ce projet reste cependant un petit cran en
dessous de ce que peut proposer un logiciel hébergé par la fondation
Apache et soumis à une gestion communautaire multipartite.

Sonatype
^^^^^^^^

image:illustrations/MangaNicolas.png[float="left"]

Nicolas poursuit en constatant une certaine incrédulité de notre
auditoire. Le monde merveilleux de l'open-source tout gratuit, où des
développeurs-bisounours-bénévoles offrent leur temps et leur code à la
communauté, les laisse perplexes. Derrière Maven, comme partout, il y a
des gens à payer et des machines qui tournent.

Vous aurez noté dans les pages qui précèdent la très forte adhérence
entre le développement de Maven et la société Sonatype. Maven est en
effet un projet complexe, englobant des solutions techniques très
spécifiques – pensez, par exemple, à la gestion de chargeurs de classes
isolés pour chaque plugin, concept qui reste assez théorique pour une
grande majorité de développeurs.

Parce que Sonatype met des développeurs de talent à temps plein sur le
développement de Maven, le prix à payer pour suivre les développements
en tant que simple contributeur est démesuré. Les technologies engagées
sont nombreuses et nécessitent un gros investissement en temps.
L'évolution du développement est rapide et peu documenté, il est donc
difficile de se faire en peu de temps une idée précise des tâches en
cours et de leur avancement.

Maven est cependant un projet de la fondation Apache, dont nous avons vu
les règles de conduite, et, à ce titre, on peut trouver choquant de le
voir mêlé de si près au nom d'une seule société.

Maven3

En fait, en creusant un peu, on constate même rapidement que Sonatype
est bien plus qu’un contributeur de Maven : des composants majeurs de
Maven 3 ne sont pas développés et hébergés par la fondation Apache, mais
sous le compte GitHub de Sonatype !

Un peu de stratégie
^^^^^^^^^^^^^^^^^^^

Parmi la refonte réalisée pour Maven 3, un élément clé est la réécriture
complète de la gestion des dépendances. Après deux tentatives
infructueuses, Sonatype a proposé un développement interne,
Aetherlink:#_ftn61[[61]], hébergé en open-source dans sa propre forge,
et contribué à la fondation Eclipse. Il en est de même de
Sisulink:#_ftn62[[62]], qui permet à Maven3 de fonctionner sur la base
du conteneur Google Guice tout en restant compatible avec Plexus, qui
jouait ce rôle dans Maven 2 et est encore très présent dans de nombreux
composants.

Sonatype, qui pilote donc seul ces projets cruciaux pour Maven, a choisi
d'en faire une solution open-source. Bien sûr, Sonatype prend une
longueur d'avance sur tout concurrent qui voudrait occuper ce terrain,
et s’ouvre les portes de la fondation Eclipse et la reconnaissance
associée, mais la démarche doit tout de même être soulignée. De
nombreuses autres sociétés, moins imprégnées par le modèle open-source,
n'auraient pas suivi cette voie et auraient tenté de monnayer leur
compétence.

Verrouiller l’accès à Maven serait contre-productif. Une majorité des
utilisateurs – et donc des clients potentiels – se tournerait vers des
solutions libres, éventuellement moins bien intégrées. Le monde Java est
particulièrement marqué par le modèle open-source, et le seul argument
financier ne suffit pas à expliquer cet engouement. Aller contre les
attentes du public pour une société comme Sonatype serait comme couper
la branche sur laquelle on est assis. Par contre, une fois devenu le
standard de fait, monnayer l’expertise et le support autour d’un outil
devenu stratégique pour beaucoup d’entreprises est un avantage
commercial sans équivalent, quitte à se froisser un peu avec les membres
de la fondation Apache.

Open ? -source
^^^^^^^^^^^^^^

En dehors de cette considération purement stratégique, il ne faut pas
non plus oublier qui constitue l'équipe de Sonatype. Vous avez affaire à
des gens techno-addicts, pas à des financiers. Des gens qui se
passionnent pour le code et les nouveautés technologiques, et qui ne
laisseraient à personne le soin de coder à leur place. Ces gens sont
imprégnés par le modèle open-source et n'auraient pas l'idée de lancer
un nouvel outil en dehors de cet esprit. Ils sont au cœur du projet
qu'ils ont construit et vu s'imposer, rien ne leur ferait plus mal que
de voir leur bébé devenir une marchandise de plus.

Par contre, ils n’aiment pas forcément se faire dicter leur conduite par
des personnes qui n’apportent rien de plus que des critiques. Aussi, le
modèle de développement Apache, basé sur le compromis et le consensus,
est régulièrement mis à mal par des décisions unilatérales. Autant le
code reste ouvert et protégé par le mécanisme de licences, autant
l’ouverture propre au développement communautaire n’est pas
systématique.  

Cependant, l'équipe de développement de Maven ne se résume pas à ces
quelques personnes. L'équipe complètelink:#_ftn63[[63]] compte des
individus d'origines très variées et rattachés à des employeurs de
toutes sortes. Pris individuellement, ils sont peu visibles, mais, comme
pour tout projet open-source, c'est ensemble qu'ils ont donné vie au
projet Maven, et en particulier à son large écosystème de plugins.

La garantie par l'open-source
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

Si Sonatype se comporte aujourd'hui comme un exemple dans sa démarche de
contribution à l'open-source, qu'en sera-t-il à l'avenir ? Que
deviendrait Maven si cette société venait à être rachetée par un groupe
aux intentions plus lucratives ? Après tout, en moins d'un an, nous
avons vu Oracle racheter Bea puis SUN pendant que VMware rachetait
SpringSource qui venait d’absorber G2One. Qu'en pensent ceux qui ont
misé sur la machine virtuelle Java alternative JRockit et qui ne peuvent
même plus la télécharger sans passer par le service de support
d'Oracle ?

Ne perdons pas de vue deux éléments clés :

·     Maven est développé sous licence libre Apache. Quoi qu'il arrive,
personne ne pourra vous réclamer de droits si vous prenez ce code pour
en faire ce que bon vous semble. En particulier, si une société
investissait massivement dans le développement pour créer un Maven
Professional payant (ce que la licence Apache n'interdirait pas), cela
ne ferait que vous priver des fonctionnalités ajoutées à la version
libre. Si la différence est réellement une plus-value significative, le
prix qui en serait demandé serait peut-être justifié. Dans le cas
contraire, la version libre restera libre et pourra tenter de développer
les mêmes services, voire mieux, ce qui s'est déjà vu.

·     Le développement de Maven est porté par ses développeurs. Le droit
à modifier le code source de Maven est attribué à des personnes
reconnues pour la qualité de leur contribution à la communauté et pour
leur capacité à travailler selon un modèle communautaire. En aucun cas,
une société ne peut prétendre posséder Maven ou son équipe de
développement (à moins de tous les embaucher). Des développeurs
open-source qui verraient leur société prendre une position trop
lucrative ne manqueraient pas d'aller voir ailleurs, emportant avec eux
la clé d'accès au SVN de Maven. Sauf crise grave sur le marché de
l'emploi en informatique, il restera toujours des développeurs
indépendants ou raisonnablement liés à leur société pour faire de Maven
un projet libre.

·     Dans le pire des cas, rien n'interdit un autre groupe de
développeurs, libres ou liés par une société concurrente, de repartir du
code existant et de créer un nouveau projet dérivé de Maven, comme IBM
l'a fait avec IBM HTTP Server en partant de Apache HTTPd. Cette
situation extrême a déjà été rencontrée dans le monde open-source et est
qualifiée de fork. Il s'agit cependant d'une situation rare, une sorte
de solution de la dernière chance lorsque des conflits internes ne
peuvent être réglés à l'amiable, mais ce n’est pas une porte de sortie
théorique : elle a déjà été employée à de nombreuses reprises. Cela
reste une sécurité non négligeable que tout projet open-source offre :
si le développement commence à prendre une voie qui déplaît à une partie
de l'équipe, ils peuvent faire le choix de mettre en pratique leurs
propres idées, certes avec des effets néfastes sur l'image du projet,
mais démontrant ainsi la force du modèle libre. Jenkins est né de cette
façon, comme LibreOffice ou ChiliProject …

Conclusion
~~~~~~~~~~

Le comité nous remercie et s'apprête à délibérer. Nous n'aurons sa
conclusion qu'après quelques jours (ce sont des gens très occupés) : feu
vert.

$$$ commite-feuvert.png[float="left"] $$$

Maven ne répond pas à toutes les exigences sans quelques efforts, et il
ne sait pas non plus faire le café. Son utilisation nécessite un
apprentissage, peut déraper vers un grand n'importe quoi si on n'y fait
pas attention et nécessite une prise de conscience de son
fonctionnement. Si vous lisez ces lignes, vous en êtes probablement déjà
convaincu.

Maven est aussi un projet vivant, toujours ouvert à de nouvelles idées,
même si elles n’aboutissent pas en quelques semaines. Un outil utilisé
par des milliers de projets ne se modifie pas à la légère. L'avenir de
Maven est encore flou, toute prédiction de la disponibilité des
prochaines évolutions étant totalement aléatoire, cependant il n'est pas
près de s'arrêter en si bon chemin. La communauté ne cesse de croître,
supportée par de nouvelles sociétés dont il est le cœur de métier. Son
succès en entreprise démontre un réel besoin d'homogénéité des outils de
développement, et de ce fait sa logique interne fait mouche. Le modèle
open-source ne fait plus peur comme il y a quelques années, et ceux qui
sont à sa base ne sont plus des idéalistes barbus en sandales +
chaussettes mais des professionnels pragmatiques.

Là où les outils basés sur des scripts donnent de la flexibilité, Maven
oppose une logique de maîtrise du processus et de ses étapes clés. Le
nombre de lignes nécessaires pour réaliser telle tâche n'a aucune
importance, ce qui compte c'est que l'outil soit cohérent. La
concurrence commence à suivre également cette piste, apportant des idées
nouvelles qui pourront tout autant profiter à Maven.

Nous sommes convaincus que Maven a encore de très beaux jours devant
lui. Maven 3 promet des évolutions importantes qui feront sauter de
nombreux verrous, comme en témoigne son intégration dans nos IDE. Quant
à l'armada de plugins qui gravitent autour, elle ne fait qu’augmenter et
prend une place croissante dans les développements de nouveaux outils.
Jusqu'ici, il n'était pas envisageable de proposer un outil sans une
tâche Ant. Il devient délicat de ne pas proposer également un plugin
Maven, sous peine de crouler sous les réclamations répétées des
utilisateurs.
